# Templates

- <https://github.com/actions/template>

## checkout

- Checkout the repository

```yaml
steps:
  - name: Checkout the repo!
    uses: actions/checkout@v3
```

## upload-artifact

```yaml
- name: Upload package
  uses: actions/upload-artifact@v3
  with:
    name: built-packages
    path: ${{ github.workspace }}/*.pkg.tar.*
```

## github-script

- Run javascript code to fetch gh api

```yaml
- name: Verify PR number
  uses: actions/github-script@v5
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    result-encoding: string
    script: |
      const response = await github.rest.pulls.get({
        owner: context.repo.owner,
        repo: context. repo.repo,
        pull_number: ${{ github.event.inputs.PR_number }}
      });
    if (response.data.number !== ${{ github.events.inputs.PR_number }}) {
      throw new Error("Invalid PR");
    } else {
      console.log("PR ref: " + response.data.head.ref);
      return response.data.head.ref;
    }
```

```javascript
github.rest.issues.createComment({
  issue_number: ${{ github.event.inputs.PR_number }},
  owner: context.repo.owner,
  body: output
})

```

## deploy-pages

- Expects an artifact named `github-pages` to have been created prior to execution.
- Outputs: `page_url`

```yaml
deploy:
  runs-on: ubuntu-latest
  needs: build
  environment:
    name: github-pages
    url: ${{ steps.deployment.outputs.page_url }}
  steps:
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2
```

## cache

```yaml
- run: echo "cache_id=$(date --utc '+%V')" >> $GITHUB_ENV
- uses: actions/cache@v3
  with:
    key: mkdocs-material-${{ env.cache_id }}
    path: .cache
    restore-keys: |
      mkdocs-material-
```

## setup-python

```yaml
- uses: actions/setup-python@v4
  with:
    python-version: 3.x
```

## setup-node

```yaml
- name: Detect package manager
  id: detect-package-manager
  run: |
    if [ -f "${{ github.workspace }}/yarn.lock" ]; then
      echo "manager=yarn" >> $GITHUB_OUTPUT
      echo "command=install" >> $GITHUB_OUTPUT
      echo "runner=yarn" >> $GITHUB_OUTPUT
      exit 0
    elif [ -f "${{ github.workspace }}/package.json" ]; then
      echo "manager=npm" >> $GITHUB_OUTPUT
      echo "command=ci" >> $GITHUB_OUTPUT
      echo "runner=npx --no-install" >> $GITHUB_OUTPUT
      exit 0
    else
      echo "Unable to determine package manager"
      exit 1
    fi
- name: Setup Node
  uses: actions/setup-node@v3
  with:
    node-version: "16"
    cache: ${{ steps.detect-package-manager.outputs.manager }}
```
